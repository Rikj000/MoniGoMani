name: 'Disco Runner ðŸ‘¯'
# description: 'Party like we have never done before'
# author: 'github.com/topscoder'

on:
  push:
    branches:
      - 'feature/disco'
  schedule:
    - cron: '37 16,22,4,10 * * *'

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      DISCORD_MESSAGE: ${{ secrets.DISCORD_MESSAGE }}
      DISCORD_CHANNEL_URL: ${{ secrets.DISCORD_CHANNEL_URL }}
      DISCORD_USERNAME: ${{ secrets.DISCORD_USERNAME }}
      DISCORD_PASSWORD: ${{ secrets.DISCORD_PASSWORD }}
      DISCORD_TEXTBOX_SELECTOR: ${{ secrets.DISCORD_TEXTBOX_SELECTOR }}
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '12'
      - run: |
          npm install puppeteer
          npm install puppeteer-extra
          npm install puppeteer-extra-plugin-stealth
          DISCORD_MESSAGE="${{ secrets.DISCORD_MESSAGE }}" \
          DISCORD_USERNAME="${{ secrets.DISCORD_USERNAME }}" \
          DISCORD_PASSWORD="peekaboo!"
          DISCORD_CHANNEL_URL="${{ secrets.DISCORD_CHANNEL_URL }}" \
          DISCORD_TEXTBOX_SELECTOR="${{ secrets.DISCORD_TEXTBOX_SELECTOR }}"
          node ./.github/scripts/disco.js
